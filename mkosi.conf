# mkosi configuration for pystemd E2E testing
# This creates a Fedora image with systemd and Python for testing

[Distribution]
Distribution=fedora
Release=43

[Output]
ImageId=pystemd-test
Format=directory

[Content]
Ssh=no
Autologin=yes
RootPassword=root
Locale=en_US.UTF-8
Timezone=UTC
Hostname=pystemd-test
Packages=
    systemd
    systemd-container
    systemd-devel
    systemd-resolved
    dbus-devel
    gcc
    libxml2-devel
    libxslt-devel
    pkgconf-pkg-config
    openssl
    openssh-server

# Install build dependencies
BuildPackages=
    rpm
    uv

# Build script will be in mkosi.build
WithDocs=no

[Build]
# Build and install pystemd from source
BuildSources=.

# Enable network access during build for pip and uv
WithNetwork=yes

[Config]
# Pass PYTHON_VERSION from host environment
PassEnvironment=PYTHON_VERSION

[Runtime]
# Run in ephemeral mode - changes are discarded after shutdown
Ephemeral=yes
VSock=yes
